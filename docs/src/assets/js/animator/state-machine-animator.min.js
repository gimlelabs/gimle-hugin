"use strict";var StateMachineAnimator=(()=>{var V=Object.defineProperty;var ct=Object.getOwnPropertyDescriptor;var ut=Object.getOwnPropertyNames;var pt=Object.prototype.hasOwnProperty;var gt=(n,t)=>{for(var e in t)V(n,e,{get:t[e],enumerable:!0})},mt=(n,t,e,i)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of ut(t))!pt.call(n,s)&&s!==e&&V(n,s,{get:()=>t[s],enumerable:!(i=ct(t,s))||i.enumerable});return n};var ft=n=>mt(V({},"__esModule",{value:!0}),n);var wt={};gt(wt,{SVGRenderer:()=>A,StateMachineAnimator:()=>I,categoryLabels:()=>st,darkTheme:()=>W,dimensions:()=>l,easeIn:()=>J,easeInBack:()=>q,easeInBounce:()=>ht,easeInCubic:()=>O,easeInOut:()=>et,easeInOutBack:()=>K,easeInOutCubic:()=>M,easeInOutQuad:()=>j,easeInQuad:()=>Z,easeOut:()=>tt,easeOutBack:()=>U,easeOutBounce:()=>_,easeOutCubic:()=>z,easeOutQuad:()=>N,easingPresets:()=>F,getEasing:()=>lt,getStateCategory:()=>T,getStateColors:()=>$,getTheme:()=>G,lightTheme:()=>L,linear:()=>Q});function T(n){switch(n){case"AskOracle":case"OracleResponse":return"llm";case"ToolCall":case"ToolResult":return"tool";case"AgentCall":case"AgentResult":case"TaskDefinition":case"TaskChain":return"agent";case"AskHuman":case"HumanResponse":case"ExternalInput":return"user";case"TaskResult":case"Waiting":return"terminal";default:return"agent"}}var L={background:"#ffffff",stateColors:{llm:{background:"#FFE082",border:"#E6C200",text:"#000000"},tool:{background:"#90CAF9",border:"#5BA3E0",text:"#000000"},agent:{background:"#D1C4E9",border:"#A094C0",text:"#000000"},user:{background:"#FFCDD2",border:"#E0A0A5",text:"#000000"},terminal:{background:"#A5D6A7",border:"#70B873",text:"#000000"}},textColor:"#000000",arrowColor:"#424242",stackBackground:"transparent",stackBorderColor:"transparent",toolColor:"#FFCC80",toolBorderColor:"#E6A550",fontFamily:"-apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif"},W={background:"#1a1a2e",stateColors:{llm:{background:"#3d3d00",border:"#fbc02d",text:"#fff9c4"},tool:{background:"#0d2137",border:"#5dade2",text:"#e3f2fd"},agent:{background:"#2d1f3d",border:"#bb8fce",text:"#f3e5f5"},user:{background:"#3d2600",border:"#f5b041",text:"#fff3e0"},terminal:{background:"#1a3d1f",border:"#58d68d",text:"#e8f5e9"}},textColor:"#eaecee",arrowColor:"#5dade2",stackBackground:"#2d2d44",stackBorderColor:"#3d3d5c",toolColor:"#1a2f3d",toolBorderColor:"#5dade2",fontFamily:"-apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif"};function G(n){return n==="light"?L:n==="dark"?W:n}function $(n,t){if(n.color||n.borderColor)return{background:n.color||t.stateColors.agent.background,border:n.borderColor||n.color||t.stateColors.agent.border,text:t.textColor};let e=T(n.type),i=t.stateColors[e];return{background:i.background,border:i.border,text:i.text||t.textColor}}var st={llm:"LLM Interaction",tool:"Tool Execution",agent:"Agent/Task",user:"User Input",terminal:"Terminal"};var l={state:{width:165,height:42,borderRadius:14,padding:12,fontSize:15,labelFontSize:11},stack:{stateSpacing:4,padding:0,labelHeight:40,minWidth:170,borderRadius:14},tool:{width:140,height:44,borderRadius:14,iconSize:18},artifact:{width:100,height:70,foldSize:16,borderRadius:4},arrow:{strokeWidth:1.5,headSize:6,dashArray:"5,5"},spacing:{stackGap:80,toolGap:50,branchGap:50}};function at(n){let{stateSpacing:t,padding:e,labelHeight:i}=l.stack,{height:s}=l.state;return n===0?i+e*2+s:i+e*2+n*s+(n-1)*t}function w(n,t,e,i,s){let{stateSpacing:o,padding:r,labelHeight:d}=l.stack,{height:h,width:c}=l.state,p=n+(e-c)/2,a=i-1-s,u=t+d+r+a*(h+o);return{x:p,y:u}}function yt(n){return{x:n.x+n.width/2,y:n.y+n.height/2}}function Y(n,t,e="right",i="left"){let s=(o,r)=>{switch(r){case"top":return{x:o.x+o.width/2,y:o.y};case"bottom":return{x:o.x+o.width/2,y:o.y+o.height};case"left":return{x:o.x,y:o.y+o.height/2};case"right":return{x:o.x+o.width,y:o.y+o.height/2};default:return yt(o)}};return{from:s(n,e),to:s(t,i)}}function D(n,t){let e=(n.x+t.x)/2,i=(n.y+t.y)/2,s=t.x-n.x,o=t.y-n.y,r=Math.min(Math.abs(s),Math.abs(o))*.3,d=e,h=i-r;return`M ${n.x} ${n.y} Q ${d} ${h} ${t.x} ${t.y}`}function X(n,t){let e=(n.x+t.x)/2;return`M ${n.x} ${n.y} L ${e} ${n.y} L ${e} ${t.y} L ${t.x} ${t.y}`}function H(n,t){return`M ${n.x} ${n.y} L ${t.x} ${t.y}`}var xt="http://www.w3.org/2000/svg";function y(n,t={}){let e=document.createElementNS(xt,n);for(let[i,s]of Object.entries(t))e.setAttribute(i,String(s));return e}var bt=0;function P(n){return`${n}-${++bt}`}var A=class{constructor(t){this.elements=new Map;this.resizeObserver=null;this.panX=0;this.panY=0;this.zoom=1;this.isPanning=!1;this.lastMouseX=0;this.lastMouseY=0;this.minZoom=.25;this.maxZoom=4;this.tooltipGroup=null;this.tooltipVisible=!1;if(typeof t.container=="string"){let e=document.querySelector(t.container);if(!e)throw new Error(`Container not found: ${t.container}`);this.container=e}else this.container=t.container;this.theme=G(t.theme||"light"),this.padding=t.padding??20,this.width=t.width??(this.container.clientWidth||800),this.height=t.height??(this.container.clientHeight||600),this.svg=y("svg",{width:this.width,height:this.height,viewBox:`0 0 ${this.width} ${this.height}`}),this.svg.style.fontFamily=this.theme.fontFamily,this.svg.style.display="block",this.defs=y("defs"),this.svg.appendChild(this.defs),this.addFiltersAndGradients(),this.mainGroup=y("g",{transform:`translate(${this.padding}, ${this.padding})`}),this.svg.appendChild(this.mainGroup),this.drawBackground(),this.container.appendChild(this.svg),t.responsive&&this.setupResponsive(),this.setupPanZoom(),this.createTooltip()}setupPanZoom(){this.svg.style.cursor="grab",this.svg.addEventListener("mousedown",t=>{t.button===0&&(this.isPanning=!0,this.lastMouseX=t.clientX,this.lastMouseY=t.clientY,this.svg.style.cursor="grabbing",t.preventDefault())}),this.svg.addEventListener("mousemove",t=>{if(!this.isPanning)return;let e=t.clientX-this.lastMouseX,i=t.clientY-this.lastMouseY;this.panX+=e/this.zoom,this.panY+=i/this.zoom,this.lastMouseX=t.clientX,this.lastMouseY=t.clientY,this.updateTransform()}),this.svg.addEventListener("mouseup",()=>{this.isPanning=!1,this.svg.style.cursor="grab"}),this.svg.addEventListener("mouseleave",()=>{this.isPanning=!1,this.svg.style.cursor="grab"}),this.svg.addEventListener("wheel",t=>{t.preventDefault();let e=this.svg.getBoundingClientRect(),i=t.clientX-e.left,s=t.clientY-e.top,o=t.deltaY>0?.9:1.1,r=Math.max(this.minZoom,Math.min(this.maxZoom,this.zoom*o));if(r!==this.zoom){let d=r/this.zoom;this.panX-=i/this.zoom*(d-1),this.panY-=s/this.zoom*(d-1),this.zoom=r,this.updateTransform()}})}updateTransform(){this.mainGroup.setAttribute("transform",`translate(${this.panX+this.padding}, ${this.panY+this.padding}) scale(${this.zoom})`)}resetView(){this.panX=0,this.panY=0,this.zoom=1,this.updateTransform()}setZoom(t){this.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,t)),this.updateTransform()}getZoom(){return this.zoom}createTooltip(){this.tooltipGroup=y("g",{class:"tooltip",style:"pointer-events: none; opacity: 0; transition: opacity 0.15s ease-out;"});let t=y("rect",{class:"tooltip-bg",rx:6,ry:6,fill:"rgba(45, 55, 72, 0.95)",stroke:"rgba(255, 255, 255, 0.1)","stroke-width":1});this.tooltipGroup.appendChild(t);let e=y("g",{class:"tooltip-text"});this.tooltipGroup.appendChild(e),this.svg.appendChild(this.tooltipGroup)}showTooltip(t,e,i){if(!this.tooltipGroup)return;let s=this.tooltipGroup.querySelector(".tooltip-text"),o=this.tooltipGroup.querySelector(".tooltip-bg");for(;s.firstChild;)s.removeChild(s.firstChild);let r=12,d=18,h=r+12,c=0,p=y("text",{x:r,y:h,"font-size":13,"font-weight":"600",fill:"#fff"});if(p.textContent=t.type,s.appendChild(p),c=Math.max(c,t.type.length*8),h+=d,t.label){let f=y("text",{x:r,y:h,"font-size":11,fill:"rgba(255, 255, 255, 0.8)"});f.textContent=t.label,s.appendChild(f),c=Math.max(c,t.label.length*6),h+=d}if(t.data){h+=4;let f=Object.entries(t.data).slice(0,3);for(let[b,S]of f){let C=y("text",{x:r,y:h,"font-size":10,fill:"rgba(255, 255, 255, 0.6)"}),k=String(S).substring(0,30);C.textContent=`${b}: ${k}`,s.appendChild(C),c=Math.max(c,(b.length+k.length+2)*5.5),h+=d-4}}let a=Math.max(120,c+r*2),u=h+r-6;o.setAttribute("width",String(a)),o.setAttribute("height",String(u));let m=this.svg.getBoundingClientRect(),x=e-m.left+15,g=i-m.top-u/2;x+a>this.width-10&&(x=e-m.left-a-15),g<10&&(g=10),g+u>this.height-10&&(g=this.height-u-10),this.tooltipGroup.setAttribute("transform",`translate(${x}, ${g})`),this.tooltipGroup.style.opacity="1",this.tooltipVisible=!0}hideTooltip(){this.tooltipGroup&&this.tooltipVisible&&(this.tooltipGroup.style.opacity="0",this.tooltipVisible=!1)}panTo(t,e){this.panX=this.width/2/this.zoom-t,this.panY=this.height/2/this.zoom-e,this.updateTransform()}addFiltersAndGradients(){let t=y("filter",{id:"drop-shadow",x:"-20%",y:"-20%",width:"140%",height:"140%"}),e=y("feGaussianBlur",{in:"SourceAlpha",stdDeviation:"2",result:"blur"}),i=y("feOffset",{in:"blur",dx:"0",dy:"1",result:"offsetBlur"}),s=y("feFlood",{"flood-color":"rgba(0,0,0,0.15)",result:"color"}),o=y("feComposite",{in:"color",in2:"offsetBlur",operator:"in",result:"shadow"}),r=y("feMerge"),d=y("feMergeNode",{in:"shadow"}),h=y("feMergeNode",{in:"SourceGraphic"});r.appendChild(d),r.appendChild(h),t.appendChild(e),t.appendChild(i),t.appendChild(s),t.appendChild(o),t.appendChild(r),this.defs.appendChild(t);let c=y("filter",{id:"glow",x:"-50%",y:"-50%",width:"200%",height:"200%"}),p=y("feGaussianBlur",{stdDeviation:"3",result:"coloredBlur"}),a=y("feMerge"),u=y("feMergeNode",{in:"coloredBlur"}),m=y("feMergeNode",{in:"SourceGraphic"});a.appendChild(u),a.appendChild(m),c.appendChild(p),c.appendChild(a),this.defs.appendChild(c);let x=y("marker",{id:"arrowhead",markerWidth:"10",markerHeight:"7",refX:"9",refY:"3.5",orient:"auto",markerUnits:"strokeWidth"}),g=y("polygon",{points:"0 0, 10 3.5, 0 7",fill:this.theme.arrowColor});x.appendChild(g),this.defs.appendChild(x)}drawBackground(){let t=y("rect",{x:-this.padding,y:-this.padding,width:this.width,height:this.height,fill:this.theme.background});this.mainGroup.insertBefore(t,this.mainGroup.firstChild)}setupResponsive(){this.resizeObserver=new ResizeObserver(t=>{for(let e of t){let{width:i,height:s}=e.contentRect;i>0&&s>0&&this.resize(i,s)}}),this.resizeObserver.observe(this.container)}clear(){for(;this.mainGroup.children.length>1;)this.mainGroup.removeChild(this.mainGroup.lastChild);this.elements.clear()}resize(t,e){this.width=t,this.height=e,this.svg.setAttribute("width",String(t)),this.svg.setAttribute("height",String(e)),this.svg.setAttribute("viewBox",`0 0 ${t} ${e}`)}getElement(){return this.svg}getTheme(){return this.theme}getDrawingArea(){return{x:0,y:0,width:this.width-this.padding*2,height:this.height-this.padding*2}}drawState(t,e,i){let s=t.id||P("state"),o=$(t,this.theme),{width:r,height:d,borderRadius:h,padding:c,fontSize:p,labelFontSize:a}=l.state,u=y("g",{id:s,transform:`translate(${e}, ${i})`,class:"state-box"}),m=y("rect",{x:0,y:0,width:r,height:d,rx:h,ry:h,fill:o.background,stroke:o.border,"stroke-width":1.5});u.appendChild(m);let x=y("text",{x:r/2,y:d/2-(t.label?4:0),"font-size":p,"font-weight":"500",fill:o.text,"text-anchor":"middle","dominant-baseline":"middle"});if(x.textContent=t.type,u.appendChild(x),t.label){let f=y("text",{x:r/2,y:d/2+10,"font-size":a,fill:o.text,opacity:.7,"text-anchor":"middle","dominant-baseline":"middle"}),b=Math.floor((r-c*2)/6);f.textContent=t.label.length>b?t.label.substring(0,b-2)+"...":t.label,u.appendChild(f)}this.mainGroup.appendChild(u),u.style.cursor="pointer",u.addEventListener("mouseenter",f=>{m.setAttribute("stroke-width","2.5"),m.style.filter="brightness(1.05)",this.showTooltip(t,f.clientX,f.clientY)}),u.addEventListener("mousemove",f=>{this.tooltipVisible&&this.showTooltip(t,f.clientX,f.clientY)}),u.addEventListener("mouseleave",()=>{m.setAttribute("stroke-width","1.5"),m.style.filter="",this.hideTooltip()});let g={type:"state",id:s,element:u,bounds:{x:e,y:i,width:r,height:d}};return this.elements.set(s,g),g}drawStack(t,e,i){let s=t.id||P("stack"),{padding:o,borderRadius:r,minWidth:d}=l.stack,{width:h}=l.state,c=Math.max(d,h+o*2),p=at(t.states.length),a=y("g",{id:s,transform:`translate(${e}, ${i})`,class:"stack-container"}),u=y("rect",{x:0,y:0,width:c,height:p,rx:r,ry:r,fill:this.theme.stackBackground,stroke:this.theme.stackBorderColor,"stroke-width":1});if(a.appendChild(u),t.label){let g=y("text",{x:c/2,y:18,"font-size":14,"font-weight":"600",fill:this.theme.textColor,"text-anchor":"middle","dominant-baseline":"middle"});g.textContent=t.label,a.appendChild(g);let f=y("line",{x1:o+8,y1:32,x2:c-o-8,y2:32,stroke:this.theme.stackBorderColor,"stroke-width":1});a.appendChild(f)}this.mainGroup.appendChild(a);let m=[];for(let g=0;g<t.states.length;g++){let f=w(e,i,c,t.states.length,g),b=this.drawState(t.states[g],f.x,f.y);m.push(b)}for(let g=0;g<m.length-1;g++){let f=m[g],b=m[g+1];this.drawStackArrow({x:f.bounds.x+f.bounds.width/2,y:f.bounds.y},{x:b.bounds.x+b.bounds.width/2,y:b.bounds.y+b.bounds.height})}let x={type:"stack",id:s,element:a,bounds:{x:e,y:i,width:c,height:p},childRefs:m};return this.elements.set(s,x),x}drawStackArrow(t,e){let i=y("text",{x:t.x,y:(t.y+e.y)/2+2,"font-size":10,fill:this.theme.arrowColor,"text-anchor":"middle","dominant-baseline":"middle"});i.textContent="\u2193",this.mainGroup.appendChild(i)}drawTool(t,e,i,s=!1){let o=t.id||P("tool"),{width:r,height:d,borderRadius:h}=l.tool,c=y("g",{id:o,transform:`translate(${e}, ${i})`,class:"tool-box",style:s?"opacity: 0;":""}),p=y("rect",{x:0,y:0,width:r,height:d,rx:h,ry:h,fill:t.color||this.theme.toolColor,stroke:this.theme.toolBorderColor,"stroke-width":1.5});c.appendChild(p);let a=t.icon?`${t.icon} ${t.name}`:t.name,u=y("text",{x:r/2,y:d/2,"font-size":14,"font-weight":"500",fill:this.theme.textColor,"text-anchor":"middle","dominant-baseline":"middle"});u.textContent=a,c.appendChild(u),this.mainGroup.appendChild(c);let m={type:"tool",id:o,element:c,bounds:{x:e,y:i,width:r,height:d}};return this.elements.set(o,m),m}drawArtifact(t,e,i,s=!1){let o=t.id||P("artifact"),{width:r,height:d,foldSize:h,borderRadius:c}=l.artifact,p=y("g",{id:o,transform:`translate(${e}, ${i})`,class:"artifact",style:s?"opacity: 0;":""}),a=`
      M ${c} 0
      L ${r-h} 0
      L ${r} ${h}
      L ${r} ${d-c}
      Q ${r} ${d} ${r-c} ${d}
      L ${c} ${d}
      Q 0 ${d} 0 ${d-c}
      L 0 ${c}
      Q 0 0 ${c} 0
      Z
    `,u=y("path",{d:a,fill:t.color||"#e8f5e9",stroke:"#4caf50","stroke-width":1.5});p.appendChild(u);let m=`
      M ${r-h} 0
      L ${r-h} ${h}
      L ${r} ${h}
      Z
    `,x=y("path",{d:m,fill:"#c8e6c9",stroke:"#4caf50","stroke-width":1});p.appendChild(x);let g=t.icon;if(!g)switch(t.type){case"document":g="\u{1F4C4}";break;case"image":g="\u{1F5BC}";break;case"data":g="\u{1F4CA}";break;case"code":g="\u{1F4BB}";break;default:g="\u{1F4C1}"}let f=y("text",{x:r/2,y:d/2-6,"font-size":20,"text-anchor":"middle","dominant-baseline":"middle"});f.textContent=g,p.appendChild(f);let b=y("text",{x:r/2,y:d-12,"font-size":10,"font-weight":"500",fill:"#2e7d32","text-anchor":"middle"}),S=t.name.length>12?t.name.substring(0,10)+"...":t.name;b.textContent=t.extension?`${S}.${t.extension}`:S,p.appendChild(b),this.mainGroup.appendChild(p);let C={type:"artifact",id:o,element:p,bounds:{x:e,y:i,width:r,height:d}};return this.elements.set(o,C),C}drawArrow(t){let e=P("arrow"),{from:i,to:s,style:o="curved",strokeWidth:r=2,color:d,dashArray:h,animated:c,hidden:p}=t,a=y("g",{id:e,class:"arrow",style:p?"opacity: 0;":""}),u;switch(o){case"straight":u=H(i,s);break;case"stepped":u=X(i,s);break;case"curved":default:u=D(i,s)}let m=y("path",{d:u,fill:"none",stroke:d||this.theme.arrowColor,"stroke-width":r,"stroke-linecap":"round","marker-end":t.showHead!==!1?"url(#arrowhead)":""});h&&m.setAttribute("stroke-dasharray",h),c&&(m.setAttribute("stroke-dasharray","8 4"),m.style.animation="dash 0.5s linear infinite"),a.appendChild(m),this.mainGroup.appendChild(a);let x=Math.min(i.x,s.x),g=Math.min(i.y,s.y),f=Math.max(i.x,s.x),b=Math.max(i.y,s.y),S={type:"arrow",id:e,element:a,bounds:{x,y:g,width:f-x,height:b-g}};return this.elements.set(e,S),S}async updateArrowPath(t,e,i,s="curved",o=300){let d=t.element.querySelector("path");if(!d)return;let h;switch(s){case"straight":h=H(e,i);break;case"stepped":h=X(e,i);break;case"curved":default:h=D(e,i)}d.style.transition=`d ${o}ms ease-in-out`,d.setAttribute("d",h);let c=Math.min(e.x,i.x),p=Math.min(e.y,i.y),a=Math.max(e.x,i.x),u=Math.max(e.y,i.y);t.bounds={x:c,y:p,width:a-c,height:u-p},await new Promise(m=>setTimeout(m,o))}drawLabel(t,e,i,s={}){let o=P("label"),{fontSize:r=12,fontWeight:d="normal",color:h,anchor:c="start"}=s,p=y("text",{id:o,x:e,y:i,"font-size":r,"font-weight":d,fill:h||this.theme.textColor,"text-anchor":c,"dominant-baseline":"middle"});p.textContent=t,this.mainGroup.appendChild(p);let a={type:"label",id:o,element:p,bounds:{x:e,y:i-r/2,width:t.length*r*.6,height:r}};return this.elements.set(o,a),a}getElementRef(t){return this.elements.get(t)}removeElement(t){let e=this.elements.get(t);e&&(e.element.remove(),this.elements.delete(t))}async animate(t,e,i=500){return new Promise(s=>{if(t.style.transition=`all ${i}ms ease-in-out`,"x"in e||"y"in e){let r=(t.getAttribute("transform")||"").match(/translate\(([\d.-]+),\s*([\d.-]+)\)/),d=r?parseFloat(r[1]):0,h=r?parseFloat(r[2]):0,c="x"in e?e.x:d,p="y"in e?e.y:h;t.setAttribute("transform",`translate(${c}, ${p})`)}for(let[o,r]of Object.entries(e))o!=="x"&&o!=="y"&&t.setAttribute(o,String(r));setTimeout(s,i)})}async fadeIn(t,e=300){t.style.opacity="0",t.style.transition=`opacity ${e}ms ease-in`,t.getBoundingClientRect(),t.style.opacity="1",await new Promise(i=>setTimeout(i,e))}async fadeOut(t,e=300){t.style.transition=`opacity ${e}ms ease-out`,t.style.opacity="0",await new Promise(i=>setTimeout(i,e))}async moveTo(t,e,i,s=500){return this.animate(t,{x:e,y:i},s)}async highlight(t,e=500){let i=t.getAttribute("filter")||"";t.setAttribute("filter","url(#glow)"),await new Promise(s=>setTimeout(s,e)),t.setAttribute("filter",i)}pulse(t,e=1e3){let i=t.animate([{filter:"brightness(1)",opacity:1},{filter:"brightness(1.15)",opacity:.85},{filter:"brightness(1)",opacity:1}],{duration:e,iterations:1/0,easing:"ease-in-out"});return()=>i.cancel()}destroy(){this.resizeObserver&&this.resizeObserver.disconnect(),this.svg.remove(),this.elements.clear()}};var I=class{constructor(t){this.animationQueue=[];this.isPlaying=!1;this.isPaused=!1;this.speedMultiplier=1;this.stacks=new Map;this.eventListeners=new Map;this.defaultAnimationDuration=500;this.renderer=new A(t)}async play(){if(!this.isPlaying){for(this.isPlaying=!0,this.isPaused=!1,this.emit("animationStart");this.animationQueue.length>0&&!this.isPaused;){let t=this.animationQueue.shift();t&&await t.fn()}this.isPlaying=!1,this.emit("animationComplete")}}pause(){this.isPaused=!0}resume(){this.isPaused&&(this.isPaused=!1,this.play())}stop(){this.animationQueue=[],this.isPlaying=!1,this.isPaused=!1}reset(){this.stop(),this.renderer.clear(),this.renderer.resetView(),this.stacks.clear()}setSpeed(t){this.speedMultiplier=Math.max(.1,Math.min(10,t))}resetView(){this.renderer.resetView()}setZoom(t){this.renderer.setZoom(t)}getZoom(){return this.renderer.getZoom()}getDuration(t){return(t??this.defaultAnimationDuration)/this.speedMultiplier}on(t,e){this.eventListeners.has(t)||this.eventListeners.set(t,new Set),this.eventListeners.get(t).add(e)}off(t,e){this.eventListeners.get(t)?.delete(e)}emit(t,e){this.eventListeners.get(t)?.forEach(i=>i(e))}addStack(t,e){let i=e??{x:40,y:40},s=this.renderer.drawStack(t,i.x,i.y);return this.stacks.set(t.id,{config:{...t},position:i,ref:s,stateRefs:s.childRefs?[...s.childRefs]:[]}),s}removeStack(t){this.stacks.get(t)&&(this.renderer.removeElement(t),this.stacks.delete(t))}getStack(t){return this.stacks.get(t)?.config}async pushState(t,e){let i=this.stacks.get(t);if(!i)throw new Error(`Stack not found: ${t}`);let{config:s,position:o,stateRefs:r}=i,d=this.getDuration(),h=Math.max(l.stack.minWidth,l.state.width+l.stack.padding*2),c=s.states.length+1,p=[];for(let g=0;g<r.length;g++){let f=r[g],b=w(o.x,o.y,h,c,g);p.push(this.renderer.moveTo(f.element,b.x,b.y,d/2))}p.length>0&&await Promise.all(p);let a=s.states.length,u=w(o.x,o.y,h,c,a),m=u.y-50,x=this.renderer.drawState(e,u.x,m);await this.renderer.fadeIn(x.element,d/2),await this.renderer.moveTo(x.element,u.x,u.y,d/2),s.states.push(e),r.push(x),this.emit("stateChange",{stackId:t,state:e,action:"push"})}async popState(t){let e=this.stacks.get(t);if(!e||e.config.states.length===0)return;let{config:i}=e,s=i.states[i.states.length-1];return i.states.pop(),this.emit("stateChange",{stackId:t,state:s,action:"pop"}),s}async highlightState(t,e){let i=this.stacks.get(t);i&&await this.renderer.highlight(i.ref.element,this.getDuration())}async drawConnection(t,e,i=!0){let{from:s,to:o}=Y(t.bounds,e.bounds,"right","left"),r=this.renderer.drawArrow({from:s,to:o,style:"curved",animated:i});return i&&await this.renderer.fadeIn(r.element,this.getDuration()),r}async playToolExecution(t){let e=this.getDuration(t.options?.executionDuration||500);this.renderer.clear();let i=this.addStack(t.stack,{x:60,y:60}),s=this.stacks.get(t.stack.id),o=Math.max(l.stack.minWidth,l.state.width+l.stack.padding*2),r=i.bounds.x+i.bounds.width+l.spacing.toolGap,h=this.renderer.drawTool(t.tool,r,100,!0);if(await this.delay(e/2),t.preStates&&t.preStates.length>0)for(let b of t.preStates)await this.pushState(t.stack.id,b),await this.delay(e/3);await this.pushState(t.stack.id,t.triggerState);let c=s.config.states.length-1,p=w(s.position.x,s.position.y,o,s.config.states.length,c);await this.delay(e/4),await this.renderer.fadeIn(h.element,e/3);let a=this.renderer.drawArrow({from:{x:p.x+l.state.width,y:p.y+l.state.height/2},to:{x:h.bounds.x,y:h.bounds.y+h.bounds.height*.7},style:t.options?.arrowStyle||"curved"});await this.renderer.fadeIn(a.element,e/3);let u=this.renderer.pulse(h.element,300);await this.delay(e),u();let m=s.config.states.length+1,x=w(s.position.x,s.position.y,o,m,m-1),g=this.renderer.drawArrow({from:{x:h.bounds.x,y:h.bounds.y+h.bounds.height*.3},to:{x:x.x+l.state.width,y:x.y+l.state.height/2},style:t.options?.arrowStyle||"curved"});await this.renderer.fadeIn(g.element,e/3),await this.delay(e/4);let f=w(s.position.x,s.position.y,o,s.config.states.length+1,c);if(await Promise.all([this.pushState(t.stack.id,t.resultState),this.renderer.updateArrowPath(a,{x:f.x+l.state.width,y:f.y+l.state.height/2},{x:h.bounds.x,y:h.bounds.y+h.bounds.height*.7},t.options?.arrowStyle||"curved",e/2)]),t.postStates&&t.postStates.length>0){await this.delay(e/2);let b=c+1;for(let S of t.postStates){let C=s.config.states.length+1,k=w(s.position.x,s.position.y,o,C,c),v=w(s.position.x,s.position.y,o,C,b);await Promise.all([this.pushState(t.stack.id,S),this.renderer.updateArrowPath(a,{x:k.x+l.state.width,y:k.y+l.state.height/2},{x:h.bounds.x,y:h.bounds.y+h.bounds.height*.7},t.options?.arrowStyle||"curved",e/4),this.renderer.updateArrowPath(g,{x:h.bounds.x,y:h.bounds.y+h.bounds.height*.3},{x:v.x+l.state.width,y:v.y+l.state.height/2},t.options?.arrowStyle||"curved",e/4)]),await this.delay(e/3)}}this.emit("animationComplete",{type:"toolExecution"})}async playArtifactCreation(t){let e=this.getDuration(),i=t.options?.artifactPosition||"right";this.renderer.clear();let s=this.addStack(t.stack,{x:60,y:60}),o=this.stacks.get(t.stack.id),r=Math.max(l.stack.minWidth,l.state.width+l.stack.padding*2);if(await this.delay(e/2),t.preStates&&t.preStates.length>0)for(let S of t.preStates)await this.pushState(t.stack.id,S),await this.delay(e/3);await this.pushState(t.stack.id,t.creatorState);let d=o.config.states.length-1,h=w(o.position.x,o.position.y,r,o.config.states.length,d);await this.delay(e/2);let c=i==="right"?s.bounds.x+s.bounds.width+60:s.bounds.x-l.artifact.width-60,p=h.y-10,a=this.renderer.drawArtifact(t.artifact,c,p,!0),u={x:i==="right"?h.x+l.state.width:h.x,y:h.y+l.state.height/2},m={x:i==="right"?a.bounds.x:a.bounds.x+a.bounds.width,y:a.bounds.y+a.bounds.height/2},x=this.renderer.drawArrow({from:u,to:m,style:t.options?.arrowStyle||"curved",hidden:!0});await Promise.all([this.renderer.fadeIn(a.element,e/2),this.renderer.fadeIn(x.element,e/2)]),await this.delay(e/2);let g=o.config.states.length+1,f=w(o.position.x,o.position.y,r,g,d);await Promise.all([this.pushState(t.stack.id,t.resultState),this.renderer.updateArrowPath(x,{x:i==="right"?f.x+l.state.width:f.x,y:f.y+l.state.height/2},m,t.options?.arrowStyle||"curved",e/4),this.renderer.moveTo(a.element,c,f.y-10,e/4)]);let b={x:m.x,y:f.y-10+a.bounds.height/2};if(await this.renderer.updateArrowPath(x,{x:i==="right"?f.x+l.state.width:f.x,y:f.y+l.state.height/2},b,t.options?.arrowStyle||"curved",100),t.postStates&&t.postStates.length>0)for(let S of t.postStates){let C=o.config.states.length+1,k=w(o.position.x,o.position.y,r,C,d),v=k.y-10,E={x:m.x,y:v+a.bounds.height/2};await Promise.all([this.pushState(t.stack.id,S),this.renderer.updateArrowPath(x,{x:i==="right"?k.x+l.state.width:k.x,y:k.y+l.state.height/2},E,t.options?.arrowStyle||"curved",e/4),this.renderer.moveTo(a.element,c,v,e/4)]),await this.delay(e/3)}this.emit("animationComplete",{type:"artifactCreation"})}async playTransitionDiagram(t){let e=this.getDuration();this.renderer.clear();let i=[{type:t.initialState},...t.transitions.map(a=>({type:a}))],s=Array.from(new Map(i.map(a=>[a.type,a])).values()),o=t.layout||"horizontal",r=o==="horizontal"?180:80,d=new Map,h=60,c=100;for(let a of s){let u=this.renderer.drawState(a,h,c);d.set(a.type,u),o==="horizontal"?h+=r:c+=r}let p=[t.initialState,...t.transitions];for(let a=0;a<p.length-1;a++){let u=d.get(p[a]),m=d.get(p[a+1]);if(u&&m){let x=o==="horizontal"?"right":"bottom",g=o==="horizontal"?"left":"top",{from:f,to:b}=Y(u.bounds,m.bounds,x,g);this.renderer.drawArrow({from:f,to:b,style:"straight"})}}for(let a=0;a<p.length;a++){let u=p[a],m=d.get(u);m&&(await this.renderer.highlight(m.element,e),await this.delay(e/2))}if(t.syncWithStack){let a=t.syncWithStack.position==="right"?h+100:t.syncWithStack.position==="left"?-200:60,u=t.syncWithStack.position==="bottom"?c+100:60;this.addStack(t.syncWithStack.stack,{x:a,y:u})}this.emit("animationComplete",{type:"transitionDiagram"})}async playBranching(t){let e=this.getDuration();this.renderer.clear();let i=this.addStack(t.sourceStack,{x:200,y:60});await this.delay(e),await this.highlightState(t.sourceStack.id,t.branchPoint),await this.delay(e/2);let s=80,o=i.bounds.y+i.bounds.height+80,r=t.layout?.spacing??l.spacing.branchGap;this.renderer.drawLabel("Branches",i.bounds.x+i.bounds.width/2,o-30,{anchor:"middle",fontSize:14,fontWeight:"600"});let d=s;for(let h of t.branches){let c={id:h.id,label:h.label||`Branch ${h.id}`,states:[...t.sourceStack.states.slice(0,t.branchPoint+1),...h.additionalStates],branchId:h.id,parentStackId:t.sourceStack.id},p=this.renderer.drawStack(c,d,o);await this.renderer.fadeIn(p.element,e);let a={x:i.bounds.x+i.bounds.width/2,y:i.bounds.y+i.bounds.height},u={x:p.bounds.x+p.bounds.width/2,y:p.bounds.y};this.renderer.drawArrow({from:a,to:u,style:"curved",dashArray:l.arrow.dashArray}),this.stacks.set(h.id,{config:c,position:{x:d,y:o},ref:p,stateRefs:[]}),d+=p.bounds.width+r,await this.delay(e/2),this.emit("branchCreated",{branchId:h.id})}this.emit("animationComplete",{type:"branching"})}async playMultiStackInteraction(t){let e=this.getDuration(),i=t.options?.childPosition||"right";this.renderer.clear();let s=this.addStack(t.parentStack,{x:60,y:60}),o=this.stacks.get(t.parentStack.id),r=Math.max(l.stack.minWidth,l.state.width+l.stack.padding*2),d=Math.max(l.stack.minWidth,l.state.width+l.stack.padding*2),h=i==="right"?s.bounds.x+s.bounds.width+l.spacing.stackGap:s.bounds.x,c=i==="below"?s.bounds.y+s.bounds.height+l.spacing.stackGap:s.bounds.y,p={...t.childStack,states:[]};this.addStack(p,{x:h,y:c});let a=this.stacks.get(t.childStack.id);if(await this.delay(e),t.parentExecution&&t.parentExecution.length>0&&t.options?.animateParentSteps!==!1)for(let v of t.parentExecution)await this.pushState(t.parentStack.id,v),await this.delay(e/2);await this.pushState(t.parentStack.id,t.callState);let u=o.config.states.length-1,m=w(o.position.x,o.position.y,r,o.config.states.length,u);await this.delay(e/2),t.childExecution.length>0&&await this.pushState(t.childStack.id,t.childExecution[0]);let x=w(a.position.x,a.position.y,d,1,0),g=this.renderer.drawArrow({from:{x:m.x+l.state.width,y:m.y+l.state.height/2},to:{x:x.x,y:x.y+l.state.height/2},style:"curved",animated:!0});if(await this.renderer.fadeIn(g.element,e/2),t.options?.animateChildSteps!==!1&&t.childExecution.length>1)for(let v=1;v<t.childExecution.length;v++){let E=t.childExecution[v],R=w(a.position.x,a.position.y,d,a.config.states.length+1,0);await Promise.all([this.pushState(t.childStack.id,E),this.renderer.updateArrowPath(g,{x:m.x+l.state.width,y:m.y+l.state.height/2},{x:R.x,y:R.y+l.state.height/2},"curved",e/4)]),await this.delay(e/2)}await this.delay(e/2);let f=a.config.states.length-1,b=w(a.position.x,a.position.y,d,a.config.states.length,f),S=w(o.position.x,o.position.y,r,o.config.states.length+1,o.config.states.length),C=this.renderer.drawArrow({from:{x:b.x,y:b.y+l.state.height/2},to:{x:S.x+l.state.width,y:S.y+l.state.height/2},style:"curved"});await this.renderer.fadeIn(C.element,e/2);let k=w(o.position.x,o.position.y,r,o.config.states.length+1,u);if(await Promise.all([this.pushState(t.parentStack.id,t.resultState),this.renderer.updateArrowPath(g,{x:k.x+l.state.width,y:k.y+l.state.height/2},{x:x.x,y:w(a.position.x,a.position.y,d,a.config.states.length,0).y+l.state.height/2},"curved",e/4)]),t.parentCompletion&&t.parentCompletion.length>0){await this.delay(e/2);let v=o.config.states.length-1,E=w(a.position.x,a.position.y,d,a.config.states.length,0),R=w(a.position.x,a.position.y,d,a.config.states.length,a.config.states.length-1);for(let dt of t.parentCompletion){let nt=o.config.states.length+1,it=w(o.position.x,o.position.y,r,nt,u),ot=w(o.position.x,o.position.y,r,nt,v);await Promise.all([this.pushState(t.parentStack.id,dt),this.renderer.updateArrowPath(g,{x:it.x+l.state.width,y:it.y+l.state.height/2},{x:E.x,y:E.y+l.state.height/2},"curved",e/4),this.renderer.updateArrowPath(C,{x:R.x,y:R.y+l.state.height/2},{x:ot.x+l.state.width,y:ot.y+l.state.height/2},"curved",e/4)]),await this.delay(e/2)}}this.emit("stackInteraction",{parentId:t.parentStack.id,childId:t.childStack.id}),this.emit("animationComplete",{type:"multiStackInteraction"})}delay(t){return new Promise(e=>setTimeout(e,t))}getRenderer(){return this.renderer}destroy(){this.stop(),this.renderer.destroy(),this.stacks.clear(),this.eventListeners.clear()}};var Q=n=>n,Z=n=>n*n,N=n=>n*(2-n),j=n=>n<.5?2*n*n:-1+(4-2*n)*n,O=n=>n*n*n,z=n=>--n*n*n+1,M=n=>n<.5?4*n*n*n:(n-1)*(2*n-2)*(2*n-2)+1;var B=2.5949095,rt=1.70158+1,q=n=>rt*n*n*n-1.70158*n*n,U=n=>1+rt*Math.pow(n-1,3)+1.70158*Math.pow(n-1,2),K=n=>n<.5?Math.pow(2*n,2)*((B+1)*2*n-B)/2:(Math.pow(2*n-2,2)*((B+1)*(n*2-2)+B)+2)/2,$t=2*Math.PI/3,It=2*Math.PI/4.5;var _=n=>n<1/2.75?7.5625*n*n:n<2/2.75?7.5625*(n-=1.5/2.75)*n+.75:n<2.5/2.75?7.5625*(n-=2.25/2.75)*n+.9375:7.5625*(n-=2.625/2.75)*n+.984375,ht=n=>1-_(1-n);var J=O,tt=z,et=M,F={linear:Q,easeIn:J,easeOut:tt,easeInOut:et,easeInQuad:Z,easeOutQuad:N,easeInOutQuad:j,easeInCubic:O,easeOutCubic:z,easeInOutCubic:M,easeInBack:q,easeOutBack:U,easeInOutBack:K};function lt(n){return typeof n=="function"?n:typeof n=="string"&&n in F?F[n]:M}return ft(wt);})();
//# sourceMappingURL=state-machine-animator.min.js.map
