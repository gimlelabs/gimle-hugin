<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Stack Branching Animation - State Machine Animator</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: #f5f5f5;
      min-height: 100vh;
      padding: 20px;
    }

    .container {
      max-width: 1000px;
      margin: 0 auto;
    }

    h1 {
      color: #2c3e50;
      margin-bottom: 10px;
    }

    .description {
      color: #666;
      margin-bottom: 20px;
      line-height: 1.6;
    }

    .animation-container {
      background: white;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      margin-bottom: 20px;
      overflow: hidden;
    }

    #animation {
      width: 100%;
      height: 500px;
    }

    .controls {
      display: flex;
      gap: 10px;
      padding: 15px;
      background: #f8f9fa;
      border-top: 1px solid #e0e0e0;
    }

    button {
      background: #9c27b0;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
      transition: background 0.2s;
    }

    button:hover {
      background: #7b1fa2;
    }

    button:disabled {
      background: #bdc3c7;
      cursor: not-allowed;
    }

    .info-box {
      background: #f3e5f5;
      border-left: 4px solid #9c27b0;
      padding: 15px;
      border-radius: 4px;
      margin-top: 20px;
    }

    .info-box h3 {
      color: #7b1fa2;
      margin-bottom: 8px;
    }

    .info-box p {
      color: #555;
      line-height: 1.6;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Stack Branching Animation</h1>
    <p class="description">
      This animation shows how an interaction stack can branch into multiple parallel
      exploration paths. Each branch starts from the same point but can explore
      different possibilities independently.
    </p>

    <div class="animation-container">
      <div id="animation"></div>
      <div class="controls">
        <button id="play-btn">Play Animation</button>
        <button id="reset-btn">Reset</button>
      </div>
    </div>

    <div class="info-box">
      <h3>About Branching</h3>
      <p>
        Stack branching is a powerful feature for exploring multiple solution paths
        in parallel. This is commonly used in Monte Carlo Tree Search (MCTS) for
        agent reasoning, where the agent explores different possible actions and
        their outcomes before committing to a decision.
      </p>
    </div>
  </div>

  <script type="module">
    import { StateMachineAnimator } from '../dist/state-machine-animator.js';

    const animator = new StateMachineAnimator({
      container: '#animation',
      theme: 'light',
      responsive: true,
    });

    const playBtn = document.getElementById('play-btn');
    const resetBtn = document.getElementById('reset-btn');

    async function runAnimation() {
      playBtn.disabled = true;

      await animator.playBranching({
        sourceStack: {
          id: 'main',
          label: 'Main Agent',
          states: [
            { type: 'TaskDefinition', label: 'Find best approach' },
            { type: 'OracleResponse', label: 'Analyzing options...' },
            { type: 'ToolCall', label: 'analyze_options' },
            { type: 'ToolResult', label: '3 options found' },
          ],
        },
        branchPoint: 3,
        branches: [
          {
            id: 'branch-a',
            label: 'Option A: Fast',
            additionalStates: [
              { type: 'OracleResponse', label: 'Trying fast approach...' },
              { type: 'ToolCall', label: 'execute_fast' },
            ],
          },
          {
            id: 'branch-b',
            label: 'Option B: Thorough',
            additionalStates: [
              { type: 'OracleResponse', label: 'Trying thorough approach...' },
              { type: 'ToolCall', label: 'execute_thorough' },
              { type: 'ToolResult', label: 'Analysis complete' },
            ],
          },
          {
            id: 'branch-c',
            label: 'Option C: Creative',
            additionalStates: [
              { type: 'OracleResponse', label: 'Trying creative approach...' },
            ],
          },
        ],
        layout: {
          direction: 'horizontal',
          spacing: 30,
        },
      });

      playBtn.disabled = false;
    }

    playBtn.addEventListener('click', runAnimation);

    resetBtn.addEventListener('click', () => {
      animator.reset();
      playBtn.disabled = false;
    });

    // Run initial animation
    runAnimation();
  </script>
</body>
</html>
